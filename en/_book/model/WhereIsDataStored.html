<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Where Is Data Stored | Learn Cassandra</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="teddymaef">
        <meta name="description" content="This book step-by-step guides **developers** to understand what Cassandra is, how Cassandra works and how to use the features and capabilities of Apache Cassandra 2.0.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../model/Indexing.html" />
        
        
        <link rel="prev" href="../model/CQLAndDataStructure.html" />
        

        <meta property="og:title" content="Where Is Data Stored | Learn Cassandra">
        <meta property="og:site_name" content="Learn Cassandra">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/teddymaef">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="..\gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="..\gitbook/style.css">
        


        
    <div class="book" data-github="teddymaef/learncassandra" data-level="2.4" data-basepath=".." data-revision="1400556204428">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/teddymaef/learncassandra" target="_blank" class="btn pull-left" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
	<!--
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
	
    
    <a href="https://github.com/teddymaef/learncassandra/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/teddymaef/learncassandra/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    
	-->
<!-- JiaThis Button BEGIN -->
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;btn=r2.gif&amp;uid=1343882460408149" charset="utf-8"></script>
<!-- JiaThis Button END -->

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >Learn Cassandra</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/teddymaef" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/teddymaef/learncassandra/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/teddymaef/learncassandra/edit/master/model/WhereIsDataStored.md" target="blank">Edit and Contribute</a>
        </li>
        

        

        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="about/AboutCassandra.html">
                
                <a href="../about/AboutCassandra.html">
                    <i class="fa fa-check"></i> <b>1.</b> About Cassandra
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="about/TheHistoryofCassandra.html">
                            
                            <a href="../about/TheHistoryofCassandra.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> The History of Cassandra
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="about/TheCAPTheorem.html">
                            
                            <a href="../about/TheCAPTheorem.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> The CAP Theorem
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="about/WhatCanCassandraDo.html">
                            
                            <a href="../about/WhatCanCassandraDo.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> What Can Cassandra Do
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="model/DataModelAndCQL.html">
                
                <a href="../model/DataModelAndCQL.html">
                    <i class="fa fa-check"></i> <b>2.</b> Data Model &amp; CQL
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="model/InternalDataStructure.html">
                            
                            <a href="../model/InternalDataStructure.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Internal Data Structure
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="model/CQL.html">
                            
                            <a href="../model/CQL.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> CQL
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="model/CQLAndDataStructure.html">
                            
                            <a href="../model/CQLAndDataStructure.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> CQL &amp; Data Structure
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="model/WhereIsDataStored.html">
                            
                            <a href="../model/WhereIsDataStored.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Where Is Data Stored
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="model/Indexing.html">
                            
                            <a href="../model/Indexing.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Indexing
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="distribution/DataDistribution.html">
                
                <a href="../distribution/DataDistribution.html">
                    <i class="fa fa-check"></i> <b>3.</b> Data Distribution
                </a>
                
                
            </li>
        
            <li  data-level="4" data-path="distribution/ConcurrencyControl.html">
                
                <a href="../distribution/ConcurrencyControl.html">
                    <i class="fa fa-check"></i> <b>4.</b> Concurrency Control
                </a>
                
                
            </li>
        
            <li  data-level="5" data-path="caching/DataCaching.html">
                
                <a href="../caching/DataCaching.html">
                    <i class="fa fa-check"></i> <b>5.</b> Data Caching
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="client/ClientRequests.html">
                
                <a href="../client/ClientRequests.html">
                    <i class="fa fa-check"></i> <b>6.</b> Client Requests
                </a>
                
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 64.28571428571429%;min-width: 57.142857142857146%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../about/AboutCassandra.html" title="About Cassandra" class="chapter done new-chapter" data-progress="1" style="left: 7.142857142857143%;"></a>
    
        <a href="../about/TheHistoryofCassandra.html" title="The History of Cassandra" class="chapter done " data-progress="1.1" style="left: 14.285714285714286%;"></a>
    
        <a href="../about/TheCAPTheorem.html" title="The CAP Theorem" class="chapter done " data-progress="1.2" style="left: 21.428571428571427%;"></a>
    
        <a href="../about/WhatCanCassandraDo.html" title="What Can Cassandra Do" class="chapter done " data-progress="1.3" style="left: 28.571428571428573%;"></a>
    
        <a href="../model/DataModelAndCQL.html" title="Data Model &amp; CQL" class="chapter done new-chapter" data-progress="2" style="left: 35.714285714285715%;"></a>
    
        <a href="../model/InternalDataStructure.html" title="Internal Data Structure" class="chapter done " data-progress="2.1" style="left: 42.857142857142854%;"></a>
    
        <a href="../model/CQL.html" title="CQL" class="chapter done " data-progress="2.2" style="left: 50%;"></a>
    
        <a href="../model/CQLAndDataStructure.html" title="CQL &amp; Data Structure" class="chapter done " data-progress="2.3" style="left: 57.142857142857146%;"></a>
    
        <a href="../model/WhereIsDataStored.html" title="Where Is Data Stored" class="chapter done " data-progress="2.4" style="left: 64.28571428571429%;"></a>
    
        <a href="../model/Indexing.html" title="Indexing" class="chapter  " data-progress="2.5" style="left: 71.42857142857143%;"></a>
    
        <a href="../distribution/DataDistribution.html" title="Data Distribution" class="chapter  new-chapter" data-progress="3" style="left: 78.57142857142857%;"></a>
    
        <a href="../distribution/ConcurrencyControl.html" title="Concurrency Control" class="chapter  new-chapter" data-progress="4" style="left: 85.71428571428571%;"></a>
    
        <a href="../caching/DataCaching.html" title="Data Caching" class="chapter  new-chapter" data-progress="5" style="left: 92.85714285714286%;"></a>
    
        <a href="../client/ClientRequests.html" title="Client Requests" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_3276">
                    
                        <h1 id="where-is-data-stored">Where Is Data Stored</h1>
<p>For each column family, there are 3 layer of data stores: memtable, commit log and SSTable.</p>
<p><sup><a href="#ref_1">1</a></sup>For efficiency, Cassandra does not repeat the names of the columns in memory or in the SSTable. For example, data is inserted using these CQL statements:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> k1.t1 (c1) <span class="hljs-keyword">VALUES</span> (v1);</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> k2.t1 (c1, c2) <span class="hljs-keyword">VALUES</span> (v1, v2);</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> k1.t1 (c1, c3, c2) <span class="hljs-keyword">VALUES</span> (v4, v3, v2);</span>
</code></pre>
<p>In the memtable, Cassandra stores this data:</p>
<pre><code class="lang-text">k1 c1:v4 c2:v2 c3:v3
k2 c1:v1 c2:v2
</code></pre>
<p>In the commit log on disk, Cassandra stores this data:</p>
<pre><code class="lang-text">k1, c1:v1
k2, c1:v1 C2:v2
k1, c1:v4 c3:v3 c2:v2
</code></pre>
<p>In the SSTable on disk, Cassandra stores this data after flushing the memtable:</p>
<pre><code class="lang-text">k1 c1:v4 c2:v2 c3:v3
k2 c1:v1 c2:v2
</code></pre>
<p><img src="..\assets\flush_memtable.png" alt="Figure 1"></p>
<h2 id="the-write-path">The Write Path</h2>
<p>When a write occurs, Cassandra stores the data in a structure in memory, the memtable, and also appends writes to the commit log on disk.</p>
<p>The memtable is a write-back cache of data partitions that Cassandra looks up by key. The more a table is used, the larger its memtable needs to be. Cassandra can dynamically allocate the right amount of memory for the memtable or you can manage the amount of memory being utilized yourself. The memtable, unlike a write-through cache, stores writes until reaching a limit, and then is flushed.</p>
<p>When memtable contents exceed a configurable threshold, the memtable data, which includes indexes, is put in a queue to be flushed to disk. To flush the data, Cassandra sorts memtables by partition key and then writes the data to disk sequentially. The process is extremely fast because it involves only a commitlog append and the sequential write.</p>
<p>The memtable data is flushed to SSTables on disk using sequential I/O. Data in the commit log is purged after its corresponding data in the memtable is flushed to the SSTable.</p>
<p>SSTables are immutable, not written to again after the memtable is flushed. Consequently, a partition is typically stored across multiple SSTable files So, if a row is not in memtable, a read of the row needs look-up in all the SSTable files. This is why read in Cassandra is much slower than write.</p>
<h2 id="compaction">Compaction</h2>
<p>To improve read performance as well as to utilize disk space, Cassandra periodically does compaction to create &amp; use new consolidated SSTable files instead of multiple old SSTables.</p>
<p><sup><a href="#ref_2">2</a></sup>You can configure two types of compaction to run periodically: SizeTieredCompactionStrategy and LeveledCompactionStrategy.</p>
<ul>
<li>SizeTieredCompactionStrategy is designed for write-intensive workloads</li>
<li>LeveledCompactionStrategy for read-intensive workloads</li>
</ul>
<p>For more information about compaction strategies, see <a href="http://www.datastax.com/dev/blog/when-to-use-leveled-compaction" target="_blank">When to Use Leveled Compaction</a> and <a href="http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra" target="_blank">Leveled Compaction in Apache Cassandra</a>.</p>
<h2 id="references">References</h2>
<ol>
<li><a name="ref_1"></a><a href="http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_stores_data_c.html" target="_blank">http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_stores_data_c.html</a></li>
<li><a name="ref_2"></a><a href="http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_write_path_c.html" target="_blank">http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_write_path_c.html</a></li>
</ol>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../model/CQLAndDataStructure.html" class="navigation navigation-prev " aria-label="Previous page: CQL &amp; Data Structure"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../model/Indexing.html" class="navigation navigation-next " aria-label="Next page: Indexing"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="//cdnjscn.b0.upaiyun.com/libs/ace/1.1.3/ace.js"></script>
        <script src="//cdnjscn.b0.upaiyun.com/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="..\gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="..\gitbook/app.js"></script>
        

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
