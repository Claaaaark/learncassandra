<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>CQL &amp; Data Structure | Learn Cassandra</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="teddymaef">
        <meta name="description" content="This book step-by-step guides **developers** to understand what Cassandra is, how Cassandra works and how to use the features and capabilities of Apache Cassandra 2.0.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="../model/WhereIsDataStored.html" />
        
        
        <link rel="prev" href="../model/CQL.html" />
        

        <meta property="og:title" content="CQL &amp; Data Structure | Learn Cassandra">
        <meta property="og:site_name" content="Learn Cassandra">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/teddymaef">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="..\gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="..\gitbook/style.css">
        


        
    <div class="book" data-github="teddymaef/learncassandra" data-level="2.3" data-basepath=".." data-revision="1400556204428">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/teddymaef/learncassandra" target="_blank" class="btn pull-left" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
	<!--
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
	
    
    <a href="https://github.com/teddymaef/learncassandra/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/teddymaef/learncassandra/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    
	-->
<!-- JiaThis Button BEGIN -->
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?move=0&amp;btn=r2.gif&amp;uid=1343882460408149" charset="utf-8"></script>
<!-- JiaThis Button END -->

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >Learn Cassandra</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/teddymaef" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/teddymaef/learncassandra/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/teddymaef/learncassandra/edit/master/model/CQLAndDataStructure.md" target="blank">Edit and Contribute</a>
        </li>
        

        

        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="about/AboutCassandra.html">
                
                <a href="../about/AboutCassandra.html">
                    <i class="fa fa-check"></i> <b>1.</b> About Cassandra
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="about/TheHistoryofCassandra.html">
                            
                            <a href="../about/TheHistoryofCassandra.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> The History of Cassandra
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="about/TheCAPTheorem.html">
                            
                            <a href="../about/TheCAPTheorem.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> The CAP Theorem
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="about/WhatCanCassandraDo.html">
                            
                            <a href="../about/WhatCanCassandraDo.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> What Can Cassandra Do
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="model/DataModelAndCQL.html">
                
                <a href="../model/DataModelAndCQL.html">
                    <i class="fa fa-check"></i> <b>2.</b> Data Model &amp; CQL
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="model/InternalDataStructure.html">
                            
                            <a href="../model/InternalDataStructure.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Internal Data Structure
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="model/CQL.html">
                            
                            <a href="../model/CQL.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> CQL
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="model/CQLAndDataStructure.html">
                            
                            <a href="../model/CQLAndDataStructure.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> CQL &amp; Data Structure
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="model/WhereIsDataStored.html">
                            
                            <a href="../model/WhereIsDataStored.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Where Is Data Stored
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="model/Indexing.html">
                            
                            <a href="../model/Indexing.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Indexing
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="distribution/DataDistribution.html">
                
                <a href="../distribution/DataDistribution.html">
                    <i class="fa fa-check"></i> <b>3.</b> Data Distribution
                </a>
                
                
            </li>
        
            <li  data-level="4" data-path="distribution/ConcurrencyControl.html">
                
                <a href="../distribution/ConcurrencyControl.html">
                    <i class="fa fa-check"></i> <b>4.</b> Concurrency Control
                </a>
                
                
            </li>
        
            <li  data-level="5" data-path="caching/DataCaching.html">
                
                <a href="../caching/DataCaching.html">
                    <i class="fa fa-check"></i> <b>5.</b> Data Caching
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="client/ClientRequests.html">
                
                <a href="../client/ClientRequests.html">
                    <i class="fa fa-check"></i> <b>6.</b> Client Requests
                </a>
                
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 57.142857142857146%;min-width: 50%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../about/AboutCassandra.html" title="About Cassandra" class="chapter done new-chapter" data-progress="1" style="left: 7.142857142857143%;"></a>
    
        <a href="../about/TheHistoryofCassandra.html" title="The History of Cassandra" class="chapter done " data-progress="1.1" style="left: 14.285714285714286%;"></a>
    
        <a href="../about/TheCAPTheorem.html" title="The CAP Theorem" class="chapter done " data-progress="1.2" style="left: 21.428571428571427%;"></a>
    
        <a href="../about/WhatCanCassandraDo.html" title="What Can Cassandra Do" class="chapter done " data-progress="1.3" style="left: 28.571428571428573%;"></a>
    
        <a href="../model/DataModelAndCQL.html" title="Data Model &amp; CQL" class="chapter done new-chapter" data-progress="2" style="left: 35.714285714285715%;"></a>
    
        <a href="../model/InternalDataStructure.html" title="Internal Data Structure" class="chapter done " data-progress="2.1" style="left: 42.857142857142854%;"></a>
    
        <a href="../model/CQL.html" title="CQL" class="chapter done " data-progress="2.2" style="left: 50%;"></a>
    
        <a href="../model/CQLAndDataStructure.html" title="CQL &amp; Data Structure" class="chapter done " data-progress="2.3" style="left: 57.142857142857146%;"></a>
    
        <a href="../model/WhereIsDataStored.html" title="Where Is Data Stored" class="chapter  " data-progress="2.4" style="left: 64.28571428571429%;"></a>
    
        <a href="../model/Indexing.html" title="Indexing" class="chapter  " data-progress="2.5" style="left: 71.42857142857143%;"></a>
    
        <a href="../distribution/DataDistribution.html" title="Data Distribution" class="chapter  new-chapter" data-progress="3" style="left: 78.57142857142857%;"></a>
    
        <a href="../distribution/ConcurrencyControl.html" title="Concurrency Control" class="chapter  new-chapter" data-progress="4" style="left: 85.71428571428571%;"></a>
    
        <a href="../caching/DataCaching.html" title="Data Caching" class="chapter  new-chapter" data-progress="5" style="left: 92.85714285714286%;"></a>
    
        <a href="../client/ClientRequests.html" title="Client Requests" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_3273">
                    
                        <h1 id="cql-data-structure-">CQL &amp; Data Structure?</h1>
<p>The recommended API for creating schemas in Cassandra since 0.7 is via CQL. But Cassandra encourages developer to share schema information to achieve more transparency. Why? Because although CQL looks very much like SQL, they don&#39;t work in a similar way internally. Remember, for each column family, don’t think of a relational table. Instead, think of a nested sorted map data structure.</p>
<h2 id="a-simple-example">A Simple Example</h2>
<p>For example, creating ColumnFamily(Table) with CQL:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> example (
    field1 <span class="hljs-keyword">int</span> <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>,
    field2 <span class="hljs-keyword">int</span>,
    field3 <span class="hljs-keyword">int</span>);</span>
</code></pre>
<p>And insert a few example rows:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> example (field1, field2, field3) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> example (field1, field2, field3) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>);</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> example (field1, field2, field3) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>);</span>
</code></pre>
<p>How is the data stored?</p>
<pre><code class="lang-text">RowKey: 1
=&gt; (column=, value=, timestamp=1374546754299000)
=&gt; (column=field2, value=00000002, timestamp=1374546754299000)
=&gt; (column=field3, value=00000003, timestamp=1374546754299000)
-------------------
RowKey: 4
=&gt; (column=, value=, timestamp=1374546757815000)
=&gt; (column=field2, value=00000005, timestamp=1374546757815000)
=&gt; (column=field3, value=00000006, timestamp=1374546757815000)
-------------------
RowKey: 7
=&gt; (column=, value=, timestamp=1374546761055000)
=&gt; (column=field2, value=00000008, timestamp=1374546761055000)
=&gt; (column=field3, value=00000009, timestamp=1374546761055000)
</code></pre>
<p>For each item above, there are 3 important things to look at: the row key (RowKey: &lt;?&gt;), the column name (column=&lt;?&gt;) and the column value (value=&lt;?&gt;). From these examples, we can make a couple of initial observations about the mapping from CQL statements to their internal representations.</p>
<ul>
<li>The value of the CQL primary key is used internally as the row key (which in the new CQL paradigm is being called a “partition key”)</li>
<li>The names of the non-primary key CQL fields are used internally as columns names, and the values of the non-primary key CQL fields are then internally stored as the corresponding column values</li>
<li>The columns of each <em>RowKey</em> is sorted by column names</li>
</ul>
<p>You may have also noticed that these rows all contain columns with no column name and no column value. This is not a bug! It’s actually a way of handling the fact that it should be possible to declare the existence of field1=&lt;some number&gt; without necessarily specifying values for field2 or field3.</p>
<h2 id="a-more-complex-example">A More Complex Example</h2>
<p>A more complicated example:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> example (
    partitionKey1 text,
    partitionKey2 text,
    clusterKey1 text,
    clusterKey2 text,
    normalField1 text,
    normalField2 text,
    <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (
        (partitionKey1, partitionKey2),
        clusterKey1, clusterKey2
        )
    );</span>
</code></pre>
<p>Here we’ve named the fields to indicate where they’ll end up in the internal representation. And we’ve also pulled out all the stops. Our primary key is not only compound, but it also uses compound partition keys, (this is represented by the double nesting of the parentheses of the PRIMARY KEY) and compound cluster keys (more on partition vs. cluster keys in a bit).</p>
<p>And insert a row of data:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> example (
    partitionKey1,
    partitionKey2,
    clusterKey1,
    clusterKey2,
    normalField1,
    normalField2
    ) <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-string">'partitionVal1'</span>,
    <span class="hljs-string">'partitionVal2'</span>,
    <span class="hljs-string">'clusterVal1'</span>,
    <span class="hljs-string">'clusterVal2'</span>,
    <span class="hljs-string">'normalVal1'</span>,
    <span class="hljs-string">'normalVal2'</span>);</span>
</code></pre>
<p>How is the data stored?</p>
<pre><code class="lang-test">RowKey: partitionVal1:partitionVal2
=&gt; (column=clusterVal1:clusterVal2:, value=, timestamp=1374630892473000)
=&gt; (column=clusterVal1:clusterVal2:normalfield1, value=6e6f726d616c56616c31, timestamp=1374630892473000)
=&gt; (column=clusterVal1:clusterVal2:normalfield2, value=6e6f726d616c56616c32, timestamp=1374630892473000)
</code></pre>
<ul>
<li>Looking at <em>partitionVal1</em> and <em>partitionVal2</em> we see that these are concatenated together and used internally as the <em>RowKey</em> (a.k.a. the partition key)</li>
<li><em>clusterVal1</em> and <em>clusterVal2</em> are concatenated together and used in the names of each of the non-primary key columns</li>
<li>The actual values of <em>normalfield1</em> and <em>normalfield2</em> are encoded as the values of columns <em>clusterVal1:clusterVal2:normalfield1</em> and <em>clusterVal1:clusterVal2:normalfield2</em> respectively, that <em>is6e6f726d616c56616c31</em> becomes <em>normalVal1</em> and <em>6e6f726d616c56616c32</em> becomes <em>normalVal2</em></li>
<li>The columns of each <em>RowKey</em> is sorted by column names, and since the values of <em>clusterKey1</em> and <em>clusterKey2</em> are part of the column names, they are actually sorted by values of <em>clusterKey1</em> and <em>clusterKey2</em> first, and then the original column names specified in CQL</li>
</ul>
<h2 id="map-list-set">Map, List &amp; Set</h2>
<p>An example of how sets, lists, and maps work under the hood:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> example (
    key1 text <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span>,
    map1 map&lt;text,text&gt;,
    list1 list&lt;text&gt;,
    set1 <span class="hljs-keyword">set</span>&lt;text&gt;
    );</span>
</code></pre>
<p>Insert:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> example (
    key1,
    map1,
    list1,
    set1
    ) <span class="hljs-keyword">VALUES</span> (
    <span class="hljs-string">'john'</span>,
    {<span class="hljs-string">'patricia'</span>:<span class="hljs-string">'555-4326'</span>,<span class="hljs-string">'doug'</span>:<span class="hljs-string">'555-1579'</span>},
    [<span class="hljs-string">'doug'</span>,<span class="hljs-string">'scott'</span>],
    {<span class="hljs-string">'patricia'</span>,<span class="hljs-string">'scott'</span>}
    )</span>
</code></pre>
<p>How is data stored?</p>
<pre><code class="lang-text">RowKey: john
=&gt; (column=, value=, timestamp=1374683971220000)
=&gt; (column=map1:doug, value=&#39;555-1579&#39;, timestamp=1374683971220000)
=&gt; (column=map1:patricia, value=&#39;555-4326&#39;, timestamp=1374683971220000)
=&gt; (column=list1:26017c10f48711e2801fdf9895e5d0f8, value=&#39;doug&#39;, timestamp=1374683971220000)
=&gt; (column=list1:26017c12f48711e2801fdf9895e5d0f8, value=&#39;scott&#39;, timestamp=1374683971220000)
=&gt; (column=set1:&#39;patricia&#39;, value=, timestamp=1374683971220000)
=&gt; (column=set1:&#39;scott&#39;, value=, timestamp=1374683971220000)
</code></pre>
<p>Internal column names for map, list and set items have different patterns:</p>
<ul>
<li>For map, each item in the map becomes a column, and the column name is the combination of the map column name and the key of the item, the value is the value of the item</li>
<li>For list, each item in the list becomes a column, and the column name is the combination of the map column name and the UUID of the item order in the list, the value is the value of the item</li>
<li>For set, each item in the set becomes a column, and the column name is the combination of the map column name and the item value, the value is always empty</li>
</ul>
<h2 id="references">References</h2>
<ol>
<li><a href="http://www.opensourceconnections.com/2013/07/24/understanding-how-cql3-maps-to-cassandras-internal-data-structure/" target="_blank">http://www.opensourceconnections.com/2013/07/24/understanding-how-cql3-maps-to-cassandras-internal-data-structure/</a></li>
<li><a href="http://www.opensourceconnections.com/2013/07/24/understanding-how-cql3-maps-to-cassandras-internal-data-structure-sets-lists-and-maps/" target="_blank">http://www.opensourceconnections.com/2013/07/24/understanding-how-cql3-maps-to-cassandras-internal-data-structure-sets-lists-and-maps/</a></li>
</ol>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../model/CQL.html" class="navigation navigation-prev " aria-label="Previous page: CQL"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../model/WhereIsDataStored.html" class="navigation navigation-next " aria-label="Next page: Where Is Data Stored"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="//cdnjscn.b0.upaiyun.com/libs/ace/1.1.3/ace.js"></script>
        <script src="//cdnjscn.b0.upaiyun.com/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="..\gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="..\gitbook/app.js"></script>
        

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
